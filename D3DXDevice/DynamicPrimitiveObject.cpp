///////////////////////////////////////////////////////////////////////////////
//
// DynamicPrimitiveObject.cpp
// 
// 4DClass Developer
// Copyright (c) 4DClass. All rights reserved.
//
///////////////////////////////////////////////////////////////////////////////

#include "DynamicPrimitiveObject.h"

///////////////////////////////////////////////////////////////////////////////
//
// CDynamicPrimitiveObject
//
// Default construction.
//
///////////////////////////////////////////////////////////////////////////////

CDynamicPrimitiveObject::CDynamicPrimitiveObject()
{
	//Set default value.
	source = (CD3DXResource *)_NULL;
}

///////////////////////////////////////////////////////////////////////////////
//
// CDynamicPrimitiveObject
//
// Default deconstruction.
//
///////////////////////////////////////////////////////////////////////////////

CDynamicPrimitiveObject::~CDynamicPrimitiveObject(void)
{
	//Check source.
	if(source != _NULL)
	{
		//Release.
		source->releaseReference();
		//Clear source.
		source = (CD3DXResource *)_NULL;
	}
}

///////////////////////////////////////////////////////////////////////////////
//
// GetSource
//
///////////////////////////////////////////////////////////////////////////////

CD3DXResource* CDynamicPrimitiveObject::getSource() const
{
	//Return result.
	return source;
}

///////////////////////////////////////////////////////////////////////////////
//
// SetSource
//
///////////////////////////////////////////////////////////////////////////////

void CDynamicPrimitiveObject::setSource(CD3DXResource* resource)
{
#ifdef _DEBUG
	assert(resource != _NULL);
#endif
	//Set source.
	this->source = resource;
	//Set name.
	this->sourceName = resource->getName();
}

///////////////////////////////////////////////////////////////////////////////
//
// GetSourceName
//
///////////////////////////////////////////////////////////////////////////////

const CNormalString& CDynamicPrimitiveObject::getSourceName() const
{
	//Return result.
	return sourceName;
}

///////////////////////////////////////////////////////////////////////////////
//
// HandleMessage
//
///////////////////////////////////////////////////////////////////////////////

HRESULT CDynamicPrimitiveObject::handleMessage(const D3DXEvent& d3dxEvent)
{
	//Check event id.
	switch(d3dxEvent.d3dxEventID)
	{
	//Release D3D9 resources created in the OnD3D9CreateDevice callback.
	case d3dxOnD3D9DestroyDevice:
		//Check source.
		if(source != _NULL)
		{
			//Release source.
			source->releaseReference();
			//Clear source.
			source = (CD3DXResource *)_NULL;
		}
		break;
	}
	//Return result.
	return CPrimitiveObject::handleMessage(d3dxEvent);
}
